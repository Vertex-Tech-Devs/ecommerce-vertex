<div class="confirmation-container">
  @if (data$ | async; as data) {
    @if (data.order) {
      <div class="confirmation-card">

        @if (data.paymentStatus === 'approved') {
          <div class="icon-success">
            <i class="bi bi-check-circle-fill"></i>
          </div>
          <h1 class="thank-you-title">¡Gracias por tu compra, {{ data.order.clientName.split(' ')[0] }}!</h1>
          <p class="subtitle">Hemos recibido tu pedido y ya lo estamos preparando.</p>
        } @else if (data.paymentStatus === 'pending' || data.paymentStatus === 'in_process') {
          <div class="icon-pending">
            <i class="bi bi-clock-history"></i>
          </div>
          <h1 class="thank-you-title">Tu pago está pendiente</h1>
          <p class="subtitle">Estamos esperando la confirmación de Mercado Pago. Te avisaremos por email cuando se apruebe.</p>
        } @else {
          <div class="icon-error">
            <i class="bi bi-x-circle-fill"></i>
          </div>
          <h1 class="thank-you-title">El pago fue rechazado</h1>
          <p class="subtitle">No se pudo procesar tu pago. Por favor, inténtalo de nuevo desde el carrito.</p>
        }

        <div class="order-summary">
          <h2 class="summary-title">Resumen de tu Pedido</h2>
          <p class="order-id">
            <strong>Número de Pedido:</strong> {{ data.order.id }}
          </p>
          @for (item of data.order.items; track item.variantId) {
            <div class="summary-item">
              <span class="item-name">{{ item.productName }} (x{{ item.quantity }})</span>
              <span class="item-price">{{ item.price * item.quantity | currency:'ARS':'$' }}</span>
            </div>
          }
          <div class="summary-total">
            <strong>Total:</strong>
            <strong>{{ data.order.total | currency:'ARS':'$' }}</strong>
          </div>
        </div>

        @if (data.paymentStatus === 'approved') {
          <p class="email-info">Te hemos enviado un correo de confirmación a <strong>{{ data.order.clientEmail }}</strong>.</p>
          <a routerLink="/shop/catalog" class="action-button">Seguir Comprando</a>
        } @else {
          <p class="email-info">Si tienes problemas, no dudes en contactarnos.</p>
          <a routerLink="/shop/cart" class="action-button">Volver al Carrito</a>
        }
      </div>
    } @else {
      <div class="loading-card">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Cargando...</span>
        </div>
        <p class="mt-3">Cargando los detalles de tu pedido...</p>
      </div>
    }
  } @else {
    <div class="loading-card">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Cargando...</span>
      </div>
      <p class="mt-3">Cargando los detalles de tu pedido...</p>
    </div>
  }
</div>