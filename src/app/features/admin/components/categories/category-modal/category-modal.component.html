<div class="modal-header modal-header-custom">
  <h4 class="modal-title w-100 text-center">{{ title }}</h4>
  <button type="button" class="btn-close btn-close-white" aria-label="Close" (click)="cancel()"></button>
</div>

<div class="modal-body">
  <form [formGroup]="categoryForm" (ngSubmit)="save()">
    
    <div class="form-content-card">
      <h5 class="modal-subtitle">Información Básica</h5>
      <div class="mb-3">
        <label for="category-name" class="form-label">Nombre de la Categoría</label>
        <input
          type="text"
          id="category-name"
          class="form-control"
          formControlName="name"
          [ngClass]="{ 'is-invalid': name?.invalid && (name?.dirty || name?.touched) }"
          (keydown.enter)="save()"
          placeholder="Ej: Indumentaria"
        />
        @if (name?.invalid && (name?.dirty || name?.touched)) {
          <div class="invalid-feedback">
            @if (name?.errors?.['required']) {
              <div>El nombre es obligatorio.</div>
            }
            @if (name?.errors?.['minlength']) {
              <div>Debe tener al menos 3 caracteres.</div>
            }
          </div>
        }
      </div>

      <hr class="my-4">

      <h5 class="modal-subtitle">Atributos para Filtros</h5>
      <p class="modal-description">Selecciona los atributos que se mostrarán en los filtros de la tienda cuando esta categoría esté activa.</p>
      
      <div class="attributes-grid-container">
        <div class="attributes-grid" formGroupName="attributesForm">
          @if (attributes$ | async; as attributes) {
            @if(attributes.length > 0) {
              @for (attr of attributes; track attr.id) {
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" role="switch" [id]="'attr-' + attr.id" [formControlName]="attr.id!">
                  <label class="form-check-label" [for]="'attr-' + attr.id">{{ attr.name }}</label>
                </div>
              }
            } @else {
              <div class="text-center text-muted small p-3">
                No hay atributos creados. <a routerLink="/admin/attributes" (click)="cancel()">Crea uno</a> primero.
              </div>
            }
          } @else {
            <div class="text-center text-muted small p-3">
              <div class="spinner-border spinner-border-sm" role="status">
                <span class="visually-hidden">Cargando...</span>
              </div>
            </div>
          }
        </div>
      </div>
    </div>

  </form>
</div>

<div class="modal-footer">
  <button type="button" class="btn btn-secondary" (click)="cancel()">Cancelar</button>
  <button type="button" class="btn btn-save-gradient" (click)="save()" [disabled]="categoryForm.invalid">
    Guardar
  </button>
</div>