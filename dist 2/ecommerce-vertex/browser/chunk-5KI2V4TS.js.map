{
  "version": 3,
  "sources": ["src/app/core/services/home-content.service.ts"],
  "sourcesContent": ["import { Injectable, inject, Injector, runInInjectionContext } from '@angular/core';\nimport { Firestore, docData } from '@angular/fire/firestore';\nimport { doc, getDoc, setDoc } from 'firebase/firestore';\nimport { Observable, firstValueFrom } from 'rxjs';\nimport { HeroBanner } from '../models/home-content.model';\nimport { StorageService } from './storage.service';\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class HomeContentService {\n  private firestore: Firestore = inject(Firestore);\n  private storageService = inject(StorageService);\n  private injector = inject(Injector);\n\n  private readonly docPath = 'siteContent/homePage';\n\n  getHeroBanner(): Observable<HeroBanner | null> {\n    return runInInjectionContext(this.injector, () => {\n      const docRef = doc(this.firestore, this.docPath);\n      return docData(docRef) as Observable<HeroBanner | null>;\n    });\n  }\n\n  async saveHomePageContent(\n    contentData: HeroBanner,\n    newBannerFile: File | null,\n    newCategoryFiles: (File | null)[]\n  ): Promise<void> {\n    const docRef = doc(this.firestore, this.docPath);\n    const dataToSave = { ...contentData };\n\n    const currentDocSnap = await getDoc(docRef);\n    const currentData = currentDocSnap.data() as HeroBanner | undefined;\n\n    if (newBannerFile) {\n      if (currentData?.imageUrl) {\n        await firstValueFrom(\n          this.storageService.deleteFileByUrl(currentData.imageUrl)\n        );\n      }\n      const imagePath = `site-images/home-banner-${new Date().getTime()}`;\n      const upload = this.storageService.uploadFile(newBannerFile, imagePath);\n      dataToSave.imageUrl = await firstValueFrom(upload.downloadUrl$);\n    }\n\n    if (dataToSave.featuredCategories && newCategoryFiles.length > 0) {\n      const uploadPromises = dataToSave.featuredCategories.map(\n        async (category, index) => {\n          const categoryFile = newCategoryFiles[index];\n          if (categoryFile) {\n            const oldCategoryImageUrl =\n              currentData?.featuredCategories?.[index]?.imageUrl;\n            if (oldCategoryImageUrl) {\n              await firstValueFrom(\n                this.storageService.deleteFileByUrl(oldCategoryImageUrl)\n              );\n            }\n            const categoryImagePath = `site-images/featured-category-${index}-${new Date().getTime()}`;\n            const upload = this.storageService.uploadFile(\n              categoryFile,\n              categoryImagePath\n            );\n            category.imageUrl = await firstValueFrom(upload.downloadUrl$);\n          }\n          return category;\n        }\n      );\n      dataToSave.featuredCategories = await Promise.all(uploadPromises);\n    }\n\n    dataToSave.lastUpdated = new Date();\n    return setDoc(docRef, dataToSave, { merge: true });\n  }\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;AAUM,IAAO,qBAAP,MAAO,oBAAkB;EACrB,YAAuB,OAAO,SAAS;EACvC,iBAAiB,OAAO,cAAc;EACtC,WAAW,OAAO,QAAQ;EAEjB,UAAU;EAE3B,gBAAa;AACX,WAAO,sBAAsB,KAAK,UAAU,MAAK;AAC/C,YAAM,SAAS,IAAI,KAAK,WAAW,KAAK,OAAO;AAC/C,aAAO,QAAQ,MAAM;IACvB,CAAC;EACH;EAEM,oBACJ,aACA,eACA,kBAAiC;;AAEjC,YAAM,SAAS,IAAI,KAAK,WAAW,KAAK,OAAO;AAC/C,YAAM,aAAa,mBAAK;AAExB,YAAM,iBAAiB,MAAM,OAAO,MAAM;AAC1C,YAAM,cAAc,eAAe,KAAI;AAEvC,UAAI,eAAe;AACjB,YAAI,aAAa,UAAU;AACzB,gBAAM,eACJ,KAAK,eAAe,gBAAgB,YAAY,QAAQ,CAAC;QAE7D;AACA,cAAM,YAAY,4BAA2B,oBAAI,KAAI,GAAG,QAAO,CAAE;AACjE,cAAM,SAAS,KAAK,eAAe,WAAW,eAAe,SAAS;AACtE,mBAAW,WAAW,MAAM,eAAe,OAAO,YAAY;MAChE;AAEA,UAAI,WAAW,sBAAsB,iBAAiB,SAAS,GAAG;AAChE,cAAM,iBAAiB,WAAW,mBAAmB,IACnD,CAAO,UAAU,UAAS;AACxB,gBAAM,eAAe,iBAAiB,KAAK;AAC3C,cAAI,cAAc;AAChB,kBAAM,sBACJ,aAAa,qBAAqB,KAAK,GAAG;AAC5C,gBAAI,qBAAqB;AACvB,oBAAM,eACJ,KAAK,eAAe,gBAAgB,mBAAmB,CAAC;YAE5D;AACA,kBAAM,oBAAoB,iCAAiC,KAAK,KAAI,oBAAI,KAAI,GAAG,QAAO,CAAE;AACxF,kBAAM,SAAS,KAAK,eAAe,WACjC,cACA,iBAAiB;AAEnB,qBAAS,WAAW,MAAM,eAAe,OAAO,YAAY;UAC9D;AACA,iBAAO;QACT,EAAC;AAEH,mBAAW,qBAAqB,MAAM,QAAQ,IAAI,cAAc;MAClE;AAEA,iBAAW,cAAc,oBAAI,KAAI;AACjC,aAAO,OAAO,QAAQ,YAAY,EAAE,OAAO,KAAI,CAAE;IACnD;;;qCA/DW,qBAAkB;EAAA;4EAAlB,qBAAkB,SAAlB,oBAAkB,WAAA,YAFjB,OAAM,CAAA;;;sEAEP,oBAAkB,CAAA;UAH9B;WAAW;MACV,YAAY;KACb;;;",
  "names": []
}
