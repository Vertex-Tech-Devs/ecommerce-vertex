{
  "version": 3,
  "sources": ["src/app/core/services/about-us.service.ts"],
  "sourcesContent": ["import { Injectable, inject, Injector, runInInjectionContext } from '@angular/core';\nimport { Firestore, docData } from '@angular/fire/firestore';\nimport { doc, setDoc } from 'firebase/firestore';\nimport { Observable, firstValueFrom } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { AboutUsData } from '@core/models/about-us.model';\nimport { StorageService } from './storage.service';\nimport { convertTimestampsToDates } from '@core/utils/date-converter';\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class AboutUsService {\n  private firestore: Firestore = inject(Firestore);\n  private storageService = inject(StorageService);\n  private injector = inject(Injector);\n\n  private readonly docRef = doc(this.firestore, 'pages/aboutUs');\n\n  getAboutUsData(): Observable<AboutUsData | undefined> {\n    return runInInjectionContext(this.injector, () => {\n      return (docData(this.docRef) as Observable<any>).pipe(\n        map(data => convertTimestampsToDates(data) as AboutUsData | undefined)\n      );\n    });\n  }\n\n  async saveAboutUsData(\n    data: AboutUsData,\n    bannerFile: File | null,\n    centralFile: File | null\n  ): Promise<void> {\n    const dataToSave = { ...data };\n\n    if (bannerFile) {\n      const path = `pages/about-us/banner_${Date.now()}_${bannerFile.name}`;\n      if (dataToSave.bannerImageUrl) {\n        await firstValueFrom(\n          this.storageService.deleteFileByUrl(dataToSave.bannerImageUrl)\n        );\n      }\n      const upload = this.storageService.uploadFile(bannerFile, path);\n      dataToSave.bannerImageUrl = await firstValueFrom(upload.downloadUrl$);\n    }\n\n    if (centralFile) {\n      const path = `pages/about-us/central_${Date.now()}_${centralFile.name}`;\n      if (dataToSave.centralImageUrl) {\n        await firstValueFrom(\n          this.storageService.deleteFileByUrl(dataToSave.centralImageUrl)\n        );\n      }\n      const upload = this.storageService.uploadFile(centralFile, path);\n      dataToSave.centralImageUrl = await firstValueFrom(upload.downloadUrl$);\n    }\n\n    return setDoc(this.docRef, dataToSave, { merge: true });\n  }\n}"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAYM,IAAO,iBAAP,MAAO,gBAAc;EACjB,YAAuB,OAAO,SAAS;EACvC,iBAAiB,OAAO,cAAc;EACtC,WAAW,OAAO,QAAQ;EAEjB,SAAS,IAAI,KAAK,WAAW,eAAe;EAE7D,iBAAc;AACZ,WAAO,sBAAsB,KAAK,UAAU,MAAK;AAC/C,aAAQ,QAAQ,KAAK,MAAM,EAAsB,KAC/C,IAAI,UAAQ,yBAAyB,IAAI,CAA4B,CAAC;IAE1E,CAAC;EACH;EAEM,gBACJ,MACA,YACA,aAAwB;;AAExB,YAAM,aAAa,mBAAK;AAExB,UAAI,YAAY;AACd,cAAM,OAAO,yBAAyB,KAAK,IAAG,CAAE,IAAI,WAAW,IAAI;AACnE,YAAI,WAAW,gBAAgB;AAC7B,gBAAM,eACJ,KAAK,eAAe,gBAAgB,WAAW,cAAc,CAAC;QAElE;AACA,cAAM,SAAS,KAAK,eAAe,WAAW,YAAY,IAAI;AAC9D,mBAAW,iBAAiB,MAAM,eAAe,OAAO,YAAY;MACtE;AAEA,UAAI,aAAa;AACf,cAAM,OAAO,0BAA0B,KAAK,IAAG,CAAE,IAAI,YAAY,IAAI;AACrE,YAAI,WAAW,iBAAiB;AAC9B,gBAAM,eACJ,KAAK,eAAe,gBAAgB,WAAW,eAAe,CAAC;QAEnE;AACA,cAAM,SAAS,KAAK,eAAe,WAAW,aAAa,IAAI;AAC/D,mBAAW,kBAAkB,MAAM,eAAe,OAAO,YAAY;MACvE;AAEA,aAAO,OAAO,KAAK,QAAQ,YAAY,EAAE,OAAO,KAAI,CAAE;IACxD;;;qCA7CW,iBAAc;EAAA;4EAAd,iBAAc,SAAd,gBAAc,WAAA,YAFb,OAAM,CAAA;;;sEAEP,gBAAc,CAAA;UAH1B;WAAW;MACV,YAAY;KACb;;;",
  "names": []
}
